CREATE TABLE CLIENTES
(
	ID_CLIENTE NUMBER NOT NULL,
	NOMBRE VARCHAR2(60) NOT NULL,
	APELLIDO VARCHAR2(60) NOT NULL,
	DIRECCION VARCHAR2(255) NOT NULL,
	TELEFONO VARCHAR2(10) NULL,
	DOC_IDENTIF VARCHAR2(80) NOT NULL,
	CONSTRAINT PK_CLIENTID PRIMARY KEY(ID_CLIENTE)
);


CREATE TABLE CUENTAS
(
	CUENTA VARCHAR2(40) NOT NULL,
	ID_CLIENTE NUMBER NOT NULL,
	SALDO NUMBER(19,4) NOT NULL,
	CONSTRAINT PK_CUENTA PRIMARY KEY (CUENTA),
	CONSTRAINT FK_CLIENTID FOREIGN KEY (ID_CLIENTE) REFERENCES CLIENTE(ID_CLIENTE)
);

CREATE TABLE LOG_CUENTAS
(
	ID_LOG NUMBER NOT NULL,
	CUENTA VARCHAR2(40) NOT NULL,
	SALDO NUMBER(19,4) NOT NULL,
	FECHA DATE NOT NULL,
	CONSTRAINT PK_LOGID PRIMARY KEY (ID_LOG),
	CONSTRAINT FK_CUENTAH FOREIGN KEY (CUENTA) REFERENCES CUENTAS(CUENTA)
);

CREATE TABLE TRANSACCIONES
(
	ID_TRANSACCION NUMBER NOT NULL,
	CUENTA_ORIGEN VARCHAR2(40) NOT NULL,
	CUENTA_DESTINO VARCHAR2(40) NOT NULL,
	IMPORTE NUMBER(19,4) NOT NULL,
	FECHA_MOVIMIENTO DATE NOT NULL,
	CONSTRAINT PK_TRANSACTIONID PRIMARY KEY (ID_TRANSACCION),
	CONSTRAINT FK_CUENTAO FOREIGN KEY (CUENTA_ORIGEN) REFERENCES CUENTAS(CUENTA),
	CONSTRAINT FK_CUENTAD FOREIGN KEY (CUENTA_DESTINO) REFERENCES CUENTAS(CUENTA)
);


CREATE SEQUENCE SEQ_CLIENT
START WITH 1
INCREMENT BY 1
NOMAXVALUE;


CREATE TRIGGER TRIG_CLIENTS
BEFORE INSERT ON CLIENTES
FOR EACH ROW
BEGIN
	SELECT SEQ_CLIENT.NEXTVAL INTO :NEW.ID_CLIENTE FROM DUAL;
END;

CREATE SEQUENCE SEQ_TRAN
START WITH 1
INCREMENT BY 1
NOMAXVALUE;

CREATE TRIGGER TRIG_TRANSACTS
BEFORE INSERT ON TRANSACCIONES
FOR EACH ROW
BEGIN
	SELECT SEQ_TRAN.NEXTVAL INTO :NEW.ID_TRANSACCION FROM DUAL;
END;


CREATE SEQUENCE SEQ_CUENTA
START WITH 1
INCREMENT BY 1
NOMAXVALUE;

CREATE TRIGGER TRIG_ACCOUNTS
BEFORE INSERT ON LOG_CUENTAS
FOR EACH ROW
BEGIN
	SELECT SEQ_CUENTA.NEXTVAL INTO :NEW.ID_LOG FROM DUAL;
END;
